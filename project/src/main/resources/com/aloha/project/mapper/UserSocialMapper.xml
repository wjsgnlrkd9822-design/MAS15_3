<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.aloha.project.mapper.UserSocialMapper">

    <!-- 소셜 계정 조회 -->
    <select id="selectSocial" resultType="UserSocial">
        SELECT 
            no,
            user_no     AS userNo,
            username,
            provider,
            social_id   AS socialId,
            name,
            email,
            created_at  AS createdAt,
            updated_at  AS updatedAt
        FROM users_social  <!-- user_social → users_social 변경 -->
        WHERE provider = #{provider}
          AND social_id = #{socialId}
    </select>

    <!-- 소셜 계정 등록 -->
    <insert id="insertSocial">
        INSERT INTO users_social (  <!-- user_social → users_social 변경 -->
            user_no,
            username,
            provider,
            social_id,
            name,
            email
        ) VALUES (
            #{userNo},
            #{username},
            #{provider},
            #{socialId},
            #{name},
            #{email}
        )
    </insert>

    <!-- 소셜 계정 정보 수정 -->
    <update id="updateSocial">
        UPDATE users_social  <!-- user_social → users_social 변경 -->
        SET 
            name = #{name},
            email = #{email},
            updated_at = CURRENT_TIMESTAMP
        WHERE provider = #{provider}
          AND social_id = #{socialId}
    </update>

    <!-- users 테이블에서 소셜 계정으로 사용자 조회 -->
    <select id="selectBySocial" resultType="User">
        SELECT 
            u.no,
            u.id,
            u.username,
            u.name,
            u.birth,
            u.email,
            u.phone,
            u.address,
            u.detail_address AS detailAddress,
            u.created_at AS createdAt,
            u.updated_at AS updatedAt,
            u.enabled
        FROM users u
        INNER JOIN users_social us ON u.no = us.user_no  <!-- user_social → users_social 변경 -->
        WHERE us.provider = #{provider}
          AND us.social_id = #{socialId}
    </select>

</mapper>