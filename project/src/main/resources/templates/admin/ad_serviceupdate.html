<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="_csrf" th:content="${_csrf.token}">
<meta name="_csrf_header" th:content="${_csrf.headerName}">
<title>ì„œë¹„ìŠ¤ ìˆ˜ì •</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body { background-color: #f5f6f7; }
.sidebar { width: 240px; background-color: #1f2933; color: #fff; }   
.sidebar h5 { font-weight: 600; }
.sidebar .nav-link { color: #cbd5e1; padding: 10px 14px; border-radius: 6px; }
.sidebar .nav-link.active, .sidebar .nav-link:hover { background-color: #374151; color: #fff; }
.header { background: #fff; border-bottom: 1px solid #e5e7eb; padding: 1rem; font-weight: 600; }
</style>
</head>
<body>
<div class="d-flex">

    <!-- ì‚¬ì´ë“œë°” -->
    <aside class="sidebar p-4 vh-100">
        <h5 class="mb-4">ê´€ë¦¬ì í˜ì´ì§€</h5>
       <nav class="nav flex-column gap-1">
            <a class="nav-link" th:href="@{/admin}">ğŸ“Š ë§¤ì¶œ ì¡°íšŒ</a>
            <a class="nav-link" th:href="@{/admin/usermanage}">ğŸ‘¥ íšŒì› ê´€ë¦¬</a>
            <a class="nav-link" th:href="@{/admin/service}">âš™ï¸ ì„œë¹„ìŠ¤ ë° ì‹œì„¤ ê´€ë¦¬</a>
            <a class="nav-link" th:href="@{/admin/trainer}">ğŸ‡ í›ˆë ¨ì‚¬ ê´€ë¦¬</a>
            <a class="nav-link" th:href="@{/admin/notice}">ğŸ“ ê³µì§€ì‚¬í•­</a>
        </nav>
    </aside>

    <!-- ë©”ì¸ ì˜ì—­ -->
    <div class="flex-fill p-4">
        <div class="header mb-4">ì„œë¹„ìŠ¤ ìˆ˜ì •</div>

        <div class="card">
            <div class="card-body">
                <!-- ìˆ˜ì • í¼ -->
                <form id="updateForm" action="/admin/update" method="put">
                    <!-- DBì—ì„œ ë¶ˆëŸ¬ì˜¨ service_no hidden -->
                    <input type="hidden" name="serviceNo" th:value="${service.serviceNo}" id="serviceNo">

                    <div class="mb-3">
                        <label class="form-label">ì„œë¹„ìŠ¤ ì´ë¦„</label>
                        <input type="text" class="form-control" name="serviceName" id="serviceName" th:value="${service.serviceName}" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">ê°€ê²©</label>
                        <input type="number" class="form-control" name="servicePrice" id="servicePrice" th:value="${service.servicePrice}" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">ì„œë¹„ìŠ¤ ì„¤ëª…</label>
                        <textarea class="form-control" name="description" id="description" rows="4" th:text="${service.description}">ì˜ˆ: ëª©ìš•, í„¸ ì†ì§ˆ í¬í•¨</textarea>
                    </div>

                    <div class="d-flex justify-content-end gap-2">
                        <a href="/admin/service" class="btn btn-secondary">ëª©ë¡ìœ¼ë¡œ</a>
                        <button type="submit" class="btn btn-primary">ì €ì¥</button>
                        <button type="button" class="btn btn-danger" onclick=actiondelete()>ì‚­ì œ</button>
                    </div>
                </form>
            </div>
        </div>
    </div>      
  </div>
  <script>
    const csrfToken = document.querySelector('meta[name="_csrf"]').content;
    const csrfHeader = document.querySelector('meta[name="_csrf_header"]').content;
    document.getElementById("updateForm").addEventListener("submit", async function(e) {
    e.preventDefault(); 

    const serviceNo = parseInt(document.getElementById("serviceNo").value)  ;    
    
    const data = {
        serviceName: document.getElementById("serviceName").value,
        servicePrice: parseInt(document.getElementById("servicePrice").value),
        description: document.getElementById("description").value
    };               

    const updateResponse = await fetch(`/admin/update/${serviceNo}`, {
        method: "PUT",
        headers: {
            "Content-Type": "application/json",
            [csrfHeader]: csrfToken
        },
        body: JSON.stringify(data)
    });     
const result = await updateResponse.text();
    if (result === "SUCCESS") {
        alert("ì„œë¹„ìŠ¤ê°€ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.");
        window.location.href = "/admin/service";
    } else {
        alert("ì„œë¹„ìŠ¤ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
    }                                                               
    });
    async function actiondelete() {
        const serviceNo = document.getElementById("serviceNo").value;

        if (!confirm("ì •ë§ë¡œ ì´ ì„œë¹„ìŠ¤ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            return;
        }

        const deleteResponse = await fetch(`/admin/service/delete/${serviceNo}`, {
            method: "DELETE",
            headers: {
                [csrfHeader]: csrfToken
            }
        }); 

        const result = await deleteResponse.text();
        if (result === "SUCCESS") {
            alert("ì„œë¹„ìŠ¤ê°€ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
            window.location.href = "/admin/service";
        } else {
            alert("ì„œë¹„ìŠ¤ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
        }
    }           
  </script>
</body>
</html>
